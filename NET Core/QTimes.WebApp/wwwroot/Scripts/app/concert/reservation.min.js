function activeDiv(n){$(".over_images_abs").each(function(){var t=$(this);t.hasClass(n)?t.addClass("active"):t.removeClass("active")})}function ReservationViewModel(){var n=this;n.Id=ko.observable();n.GuestTypeId=ko.observable();n.Size=ko.observable(1);n.Guests=ko.observableArray([]);n.Seatings=ko.observableArray([]);n.LimitSize=ko.observable(5);n.SpotName=ko.observable("");n.SpotValue=ko.observable();n.SeatNo=ko.observable("");n.GuestName=ko.observable();n.MobileNumber=ko.observable();n.Email=ko.observable();n.SeatMap=ko.observable();n.EnableTimeExpiration=ko.observable();n.ConcertEvents=ko.observableArray([]);n.CurrentConcertEvent=ko.observable();n.CurrentConcertEventName=ko.observable();n.ConcertId=ko.computed(function(){return $.cookie("concertid")});n.AddGuests=function(t){n.Guests([]);for(var i=0;i<t;i++)n.Guests.push(new Guest({Id:i+2,Name:"",MobileNo:"",SeatNo:"",SeatName:"",IsMainGuest:!1})),window.intlTelInput(document.querySelector("#mob_id"+(i+2)),{separateDialCode:!0})};n.SetSizeValue=function(t,i){n.Size($(i.currentTarget).text());$(i.currentTarget).parent().siblings().removeClass("active");$(i.currentTarget).parent().addClass("active");n.AddGuests(n.Size()-1);$(".selectpicker").selectpicker("refresh")};n.LoadSeatings=function(){if(n.CurrentConcertEvent()){var t=webserviceURL+`concerts/${n.ConcertId()}/events/${n.CurrentConcertEvent()}/seatings`;this.CurrentConcertEvent()&&(t+=`?concertEventId=${this.CurrentConcertEvent()}`);$.getJSON(t,function(t){var i=$.map(t.data.Seatings,function(n){return new Seating(n)});n.EnableTimeExpiration(t.data.EnableTimeExpiration);n.Seatings(i);n.SeatMap(t.data.SeatMapFullPath);n.LimitSize(t.data.MaxGroupSize);$("#size1").parent().addClass("active");$(".selectpicker").selectpicker("refresh")}).always(function(){HideLoader()}).fail(function(n,t,i){ShowErrorMessage(n,t,i)})}};n.OnChangeSpot=function(t,i){var u=$(i.currentTarget).siblings("select.spots"),r;for(n.SpotName($(i.currentTarget).find("option:selected").text()),u.empty(),u.append(new Option("Choose...","")),r=1;r<=n.SpotValue();r++)u.append(new Option(r,r));$(".selectpicker").selectpicker("refresh")};n.OnChangeEvent=function(t,i){if(!n.CurrentConcertEvent())return!1;this.GetConcertEventReservations();n.CurrentConcertEventName($(i.currentTarget).find("option:selected").text());n.LoadSeatings();$.cookie("eventid",t.CurrentConcertEvent());$(".selectpicker").selectpicker("refresh");RefreshSummary()};n.OnSeatSelect=function(t,i){if(!n.CurrentConcertEvent())return $.notify("Please select concert event.","error"),!1;n.EnableTimeExpiration()&&(ShowLoader(),n.SeatNo($(i.currentTarget).find("option:selected").text()),$.get(webserviceURL+`concerts/${n.ConcertId()}/events/${n.CurrentConcertEvent()}/seatlocks/${t.SpotName()+"-"+t.SeatNo()}`,function(){}).always(function(){HideLoader()}).fail(function(n,t,i){ShowErrorMessage(n,t,i)}))};n.Reservations=ko.observableArray([]);n.pagingdata=ko.observable(new PagingData({Page:1,PageSize:100,TotalData:0,TotalPages:0}));n.SearchText=ko.observable("");n.Message=ko.observable();n.ReservationGuestId=ko.observable();n.MyGuestName=ko.observable();n.MyReservationId=ko.observable();n.GuestMessages=ko.observableArray([]);n.Mode=ko.observable("NEW");n.Title=ko.observable("NEW RESERVATION");n.Load=function(){var t="?Page=1&PageSize=65535&FilterBy=Upcoming";n.SearchText()&&(t=t+"&SearchText="+n.SearchText());$.ajax({type:"GET",url:webserviceURL+`concerts/${n.ConcertId()}/events`+t,contentType:"application/json; charset=utf-8",success:function(t){n.ConcertEvents(t.data.Model);t.data.Model.length>0&&n.Mode()=="NEW"&&(n.CurrentConcertEvent(n.ConcertEvents()[0].Id),n.CurrentConcertEventName(n.ConcertEvents()[0].Name),n.LoadSeatings(),$.cookie("eventid",n.ConcertEvents()[0].Id));$(".selectpicker").selectpicker("refresh");n.GetConcertEventReservations()},error:function(n,t,i){ShowErrorMessage(n,t,i)}})};n.GetConcertEventReservations=function(t){t||ShowLoader();var i="?Page=1&PageSize=65535";n.SearchText()&&(i=i+"&SearchText="+n.SearchText());n.CurrentConcertEvent()&&(i+=`&concertEventId=${n.CurrentConcertEvent()}`);$.ajax({type:"GET",url:webserviceURL+`concerts/${n.ConcertId()}/reservations`+i,contentType:"application/json; charset=utf-8",success:function(t){var r=$.map(t.data.Model,function(n){return new Reservation(n)}),i;n.Reservations(r);i=new PagingData(t.data.PagingModel);n.pagingdata(i);HideLoader();$(".plus_more_f").click(function(){event.preventDefault();$(".plus_more_f").show();$(".minus_less_f").hide();$(this).hide();$(".head_tr").removeClass("show");$(".togg").removeClass("show");$(this).parents(".head_tr").next("tr.togg").addClass("show");$(this).parents(".head_tr").closest("tr.togg").addClass("show");$(this).parents(".head_tr").find(".minus_less_f").show()});$(".minus_less_f").click(function(){event.preventDefault();$(this).hide();$(".togg.show").removeClass("show");$(this).parents(".head_tr").find(".plus_more_f").show()})},error:function(n,t,i){HideLoader();ShowErrorMessage(n,t,i)}})};n.AddReservation=function(){var t,i,r;if(!n.CurrentConcertEvent())return $.notify("Please select concert event.","error"),!1;if(!iti.isValidNumber())return NotifyErrorMessage("Invalid Mobile No., Please enter valid number."),!1;for(ShowLoader(),t=0;t<n.Guests().length;t++)i=document.querySelector("#mob_id"+(t+2)),r=window.intlTelInputGlobals.getInstance(i),n.Guests()[t].MobileNo(r.getNumber());n.Mode()==="NEW"?$.ajax({type:"POST",url:webserviceURL+`concerts/${n.ConcertId()}/events/${n.CurrentConcertEvent()}/reservations`,data:{ConcertId:n.ConcertId(),GuestTypeId:n.GuestTypeId(),Size:n.Size(),Guests:n.Guests(),MainGuestName:n.GuestName(),MainGuestMobileNo:iti.getNumber(),MainGuestEmail:n.Email(),MainGuestSeatName:n.SpotName(),MainGuestSeatNo:n.SeatNo()},success:function(){$.notify("Reservation added successfully.","success");n.Load();$("#add-new-reserve_id").modal("hide");HideLoader();n.ClearAll()},error:function(n,t,i){HideLoader();ShowErrorMessage(n,t,i)}}):$.ajax({type:"PUT",url:webserviceURL+`concerts/${n.ConcertId()}/events/${n.CurrentConcertEvent()}/reservations/${n.Id()}`,data:{Id:n.Id(),ConcertId:n.ConcertId(),GuestTypeId:n.GuestTypeId(),Size:n.Size(),Guests:n.Guests(),MainGuestName:n.GuestName(),MainGuestMobileNo:iti.getNumber(),MainGuestEmail:n.Email(),MainGuestSeatName:n.SpotName(),MainGuestSeatNo:n.SeatNo()},success:function(){$.notify("Reservation updated successfully.","success");n.Load();$("#add-new-reserve_id").modal("hide");HideLoader();n.ClearAll()},error:function(n,t,i){HideLoader();ShowErrorMessage(n,t,i)}})};n.MessageGuest=function(t){ShowLoader();$.ajax({type:"POST",url:webserviceURL+"/reservation/message",data:{Id:t,MessageSent:n.Message()},success:function(){$.notify("Reservation cancelled successfully.","success");n.Load();HideLoader()},error:function(n,t,i){HideLoader();ShowErrorMessage(n,t,i)}})};n.OnChangeDate=function(){var t=event.target.value;n.ReservationDate(t);n.Load()};$(".search_input").unbind("keydown").on("keydown",function(t){t.which===13&&n.Load()});$(".chat-input").unbind("keydown").on("keydown",function(t){t.which===13&&n.Reply()});n.ShowNewReservationModal=function(){if(!n.CurrentConcertEvent())return $.notify("Please select concert event.","error"),!1;n.Mode("NEW");n.ClearAll();n.LoadSeatings();$("#add-new-reserve_id").modal("show")};n.Edit=function(t){var u,r,f,i;for(n.Mode("UPDATE"),ShowLoader(),n.ClearAll(),$("#add-new-reserve_id").modal("show"),n.Id(t.Id()),n.GuestTypeId(t.GuestTypeId()),$("#GuestTypeId").val(t.GuestTypeId()),n.GuestName(t.MainGuestName()),n.MobileNumber(t.MainGuestMobileNo()),iti.setNumber("+"+t.MainGuestMobileNo()),n.Email(t.MainGuestEmail()),n.Size(t.Size()),$("#size"+t.Size()).parent().siblings().removeClass("active"),$("#size"+t.Size()).parent().addClass("active"),n.Guests([]),$.map(t.Guests(),function(t){var u,f,i,r,e;if(!t.IsMainGuest()){for(n.Guests.push(new Guest({ConcertGuestId:t.ConcertGuestId(),Name:t.Name(),MobileNo:t.MobileNo(),SeatNo:t.SeatNo(),SeatName:t.SeatName(),IsMainGuest:!1})),u=$("#ddSeatName"+t.ConcertGuestId()).find("option:contains("+t.SeatName()+")"),u.attr("selected","selected"),f=u.val(),i=$("#ddSeatNo"+t.ConcertGuestId()),i.empty(),i.append(new Option("Choose...","")),r=1;r<=f;r++)i.append(new Option(r,r));i.val(t.SeatNo());e=ko.utils.arrayFirst(n.Guests(),function(n){return n.ConcertGuestId()==t.ConcertGuestId()});e.SeatNo(t.SeatNo())}}),i=0;i<n.Guests().length;i++)u=window.intlTelInput(document.querySelector("#mob_id"+(i+2)),{separateDialCode:!0}),u.setNumber("+"+n.Guests()[i].MobileNo());for(n.SpotName(t.SeatName()),$("#ddSeatName").val(t.SeatName()),r=$("#ddSeatName").find("option:contains("+t.SeatName()+")"),r.attr("selected","selected"),f=r.val(),$("#ddSeatNo").empty(),$("#ddSeatNo").append(new Option("Choose...","")),i=1;i<=f;i++)$("#ddSeatNo").append(new Option(i,i));$("#ddSeatNo").val(t.SeatNo().split("-")[1]);n.SeatNo(t.SeatNo().split("-")[1]);$(".selectpicker").selectpicker("refresh");HideLoader()};n.ShowMsg=function(t){ShowLoader();$.getJSON({url:webserviceURL+`concerts/${n.ConcertId()}/events/${n.CurrentConcertEvent()}/reservations/${t.Id()}/messages`,success:function(i){n.MyReservationId(t.Id());n.MyGuestName(t.MainGuestName());n.GuestMessages.removeAll();var r=$.map(i.data.Model,function(n){return new GuestMessage(n)});n.GuestMessages(r);$(".chat-overlay, .chat-box").fadeIn();HideLoader()},error:function(n,t,i){HideLoader();ShowErrorMessage(n,t,i)}})};n.Reply=function(){if($("#txtReply").val()==""||n.Message()=="")return!1;ShowLoader();$.ajax({type:"POST",url:webserviceURL+`concerts/${n.ConcertId()}/events/${n.CurrentConcertEvent()}/messages`,data:{Id:n.MyReservationId(),MessageSent:n.Message()},success:function(){$("#txtReply").val("");var t={};t.ConcertReservationId=n.MyReservationId();t.GuestName="Admin";t.MessageFrom="Admin";t.Message=linkify(n.Message());t.MessageDate=getFormatedDate(new Date);t.MessageTime=getFormatedTime(new Date);n.GuestMessages.unshift(t);HideLoader()},error:function(n,t,i){HideLoader();ShowErrorMessage(n,t,i)}})};n.ClearAll=function(){n.Id("");n.GuestTypeId("");n.GuestName("");n.Email("");n.Size(1);n.MobileNumber("");n.SearchText("");n.Message("");n.MyGuestName("");n.MyReservationId("");n.SeatNo("");n.SpotValue("");n.Mode()=="NEW"?n.Title("NEW RESERVATION"):n.Title("EDIT RESERVATION");n.Guests([]);activeDiv("reserve_absolute1");$(".pagination li").removeClass("active");$("#size1").parent().addClass("active");$("#ddSeatName option").each(function(){$(this).removeAttr("selected")});$("#ddSeatNo").empty();$(".selectpicker").selectpicker("refresh")};n.Load();n.LoadSeatings();setInterval(function(){},6e4)}function Reservation(n){var t=this;t.Id=ko.observable(n.Id);t.GuestTypeId=ko.observable(n.GuestTypeId);t.Size=ko.observable(n.Size);t.MainGuestName=ko.observable(n.MainGuestName);t.GuestType=ko.observable(n.GuestType);t.DOB=ko.observable(n.DOB);t.MainGuestMobileNo=ko.observable(n.MainGuestMobileNo);t.MainGuestAddress=ko.observable(n.MainGuestAddress);t.MainGuestCity=ko.observable(n.MainGuestCity);t.MainGuestState=ko.observable(n.MainGuestState);t.MainGuestZip=ko.observable(n.MainGuestZip);t.MainGuestEmail=ko.observable(n.MainGuestEmail);t.SeatNo=ko.observable(n.SeatNo);t.SeatName=ko.computed(function(){return n.SeatNo?n.SeatNo.split("-")[0]:""});t.CheckInTime=ko.computed(function(){return moment(new Date(n.CheckInTime),"HH:mm:ss").format("hh:mm A")});t.PhotoFullPath=ko.computed(function(){return n.Photo?n.PhotoFullPath:"/content/assets/images/staff_grey.png"});t.GuestTypeCss=ko.computed(function(){return n.GuestTypeId===1?"callin_check":n.GuestTypeId===2?"walkin_check":n.GuestTypeId===3?"mob_check":void 0});t.Status=ko.computed(function(){if(n.CheckInTime){if(n.TimeIn==null)return"In place";if(n.TimeIn&&!n.IsTimeOut)return"Waiting"}});t.StatusCss=ko.computed(function(){return n.CheckInTime?"status_place":"status_wait"});t.Guests=ko.computed(function(){return $.map(n.Guests,function(n){return new Guest(n)})})}function PagingData(n){var $super=this;this.Page=ko.observable(n.Page);this.PageSize=n.PageSize;this.TotalData=n.TotalData;this.TotalPages=ko.observable(n.TotalPages);this.HasPrev=ko.computed(function(){return $super.Page()>1});this.HasNext=ko.computed(function(){return $super.Page()<$super.TotalPages()});this.GoToPage=function(n){$super.Page(n);reservationViewModel.LoadList()}}function GuestMessage(n){var t=this;t.ConcertReservationId=ko.observable(n.ConcertReservationId);t.Message=ko.observable(n.MessageSent);t.GuestName=ko.observable(n.GuestName);t.MessageSentDateTimeUniversal=ko.observable(n.MessageSentDateTimeUniversal);t.MessageFrom=ko.observable(n.MessageSentBy);t.MessageTime=ko.computed(function(){var r=new Date(n.MessageSentDateTimeUniversal),t=r.getHours(),i=r.getMinutes(),u=t>=12?"pm":"am";return t=t%12,t=t?t:12,i=i<10?"0"+i:i,(t<10?"0"+t:t)+":"+i})}function Guest(n){var t=this;t.ConcertGuestId=ko.observable(n.ConcertGuestId);t.Name=ko.observable(n.Name);t.MobileNo=ko.observable(n.MobileNo);t.Email=ko.observable(n.Email);t.SeatNo=ko.observable(n.SeatNo);t.SeatName=ko.observable(n.SeatName);t.Temperature=ko.observable(n.Temperature);t.IsMainGuest=ko.observable(n.IsMainGuest);t.SpotValue=ko.observable(n.SeatNo);t.OnChangeSpot=function(n,i){var u,r;if(i){for(u=$(i.currentTarget).siblings("select.spots"),t.SeatName($(i.currentTarget).find("option:selected").text()),u.empty(),u.append(new Option("Choose...","")),r=1;r<=t.SpotValue();r++)u.append(new Option(r,r));$(".selectpicker").selectpicker("refresh")}};t.OnSeatSelect=function(n,i){reservationViewModel.EnableTimeExpiration()&&i&&(ShowLoader(),t.SeatNo($(i.currentTarget).find("option:selected").text()),$.get(webserviceURL+`concerts/${reservationViewModel.ConcertId()}/events/${reservationViewModel.CurrentConcertEvent()}/seatlocks/${n.SeatName()+"-"+n.SeatNo()}`,function(){}).always(function(){HideLoader()}).fail(function(n,t,i){ShowErrorMessage(n,t,i)}))};t.CheckInTime=ko.computed(function(){return n.CheckInTime?moment(new Date(n.CheckInTime)).format("MM/DD/YYYY hh:mm A"):""})}function Seating(n){var t=this;t.Name=ko.observable(n.Name);t.Spots=ko.observable(n.Spots);t.SeatsPerSpot=ko.observable(n.SeatsPerSpot);t.CheckInTime=ko.observable(n.CheckInTime)}var input,iti,reservationViewModel;$("body").addClass("reservation_body concert__event concert_reservation_body");$(".rev-icon").parent().parent().addClass("active");$(".rev-icon").addClass("show");input=document.querySelector("#mob_id");iti=window.intlTelInput(input,{separateDialCode:!0,utilsScript:"/content/intl-tel-input/js/utils.js"});$(".reserve_absolute1 .btn").click(function(n){n.preventDefault();activeDiv("reserve_absolute2")});$(".reserve_absolute2 .btn").click(function(n){n.preventDefault()});$(".reserve_absolute3 .backward").click(function(n){n.preventDefault();activeDiv("reserve_absolute2")});$(".reserve_absolute2 a.front_arrow").click(function(n){n.preventDefault();activeDiv("reserve_absolute1")});reservationViewModel=new ReservationViewModel;ko.applyBindings(reservationViewModel);