function ReservationViewModel(){var n=this;n.Id=ko.observable();n.GuestTypeId=ko.observable();n.GuestName=ko.observable();n.Size=ko.observable();n.LimitSize=ko.observable(0);n.Comments=ko.observable();n.MobileNumber=ko.observable();n.SelectedDate=ko.observable(moment().format("YYYY-MM-DD"));n.TimeFrom=ko.observable();n.TimeTo=ko.observable();n.Reservations=ko.observableArray([]);n.pagingdata=ko.observable(new PagingData({Page:1,PageSize:100,TotalData:0,TotalPages:0}));n.SearchText=ko.observable("");n.ReservationDate=ko.observable(moment().format("YYYY-MM-DD"));n.Message=ko.observable();n.ReservationGuestId=ko.observable();n.MyGuestName=ko.observable();n.MyReservationId=ko.observable();n.GuestMessages=ko.observableArray([]);n.Mode=ko.observable("NEW");n.Times=ko.observableArray([]);n.BusinessId=ko.computed(function(){return $.cookie("businessid")});n.ChatTimer={};n.LoadBusinessInfo=function(){$.ajax({type:"POST",url:webserviceURL+"reservation/getsummary",data:{Date:moment().format("YYYY-MM-DD"),BusinessDetailId:n.BusinessId(),CurrentTime:moment().format("HH:mm:ss")},success:function(t){n.LimitSize(t.data.LimitSize)},error:function(n,t,i){$(".loading-screen").removeClass("show");ShowErrorMessage(n,t,i)}})};n.Load=function(t){t||ShowLoader();var i="?Page="+n.pagingdata().Page()+"&PageSize="+n.pagingdata().PageSize;i=i+"&ReservationDate="+n.ReservationDate()+"&BusinessId="+n.BusinessId();n.SearchText()&&(i=i+"&SearchText="+n.SearchText());$.ajax({type:"GET",url:webserviceURL+"reservation/"+i,contentType:"application/json; charset=utf-8",success:function(t){var r=$.map(t.data.Model,function(n){return new Reservation(n)}),i;n.Reservations(r);i=new PagingData(t.data.PagingModel);n.pagingdata(i);HideLoader()},error:function(n,t,i){HideLoader();ShowErrorMessage(n,t,i)}})};n.LoadTimeSlots=function(t){ShowLoader();$.post(webserviceURL+"reservation/gettimeslots",{Date:n.SelectedDate(),BusinessId:n.BusinessId()},function(i){var u=$.map(i.data.TimeSlots,function(n){return new TimeSlot(n)}),r;n.Times(u);t&&(r=t.TimeFrom()+"-"+t.TimeTo(),$(".timeslots").siblings().removeClass("active"),$(".form_fifth").find(':checkbox[value="'+r+'"]').parent().addClass("active"),$(".timeslots").find(".input_chk").removeClass("tick"),$(".form_fifth").find(':checkbox[value="'+r+'"]').parent().find(".input_chk").addClass("tick"))}).always(function(){HideLoader()})};n.AddReservation=function(){if(!iti.isValidNumber())return NotifyErrorMessage("Invalid Mobile No., Please enter valid number."),!1;ShowLoader();n.Mode()==="NEW"?$.ajax({type:"POST",url:webserviceURL+"reservation",data:{Name:n.GuestName(),MobileNo:iti.getNumber(),GuestTypeId:n.GuestTypeId(),Size:n.Size(),Date:n.SelectedDate(),TimeFrom:n.TimeFrom(),TimeTo:n.TimeTo(),Comments:n.Comments(),BusinessDetailId:n.BusinessId()},success:function(){$.notify("Reservation added successfully.","success");$("#add-new-reserve_id").modal("hide");n.Load();LoadSummary();n.ClearAll();HideLoader()},error:function(n,t,i){HideLoader();ShowErrorMessage(n,t,i)}}):$.ajax({type:"PUT",url:webserviceURL+"reservation",data:{Id:n.Id(),Name:n.GuestName(),MobileNo:iti.getNumber(),GuestTypeId:n.GuestTypeId(),Size:n.Size(),Date:n.SelectedDate(),TimeFrom:n.TimeFrom(),TimeTo:n.TimeTo(),Comments:n.Comments(),ReservationGuestId:n.ReservationGuestId(),BusinessDetailId:n.BusinessId()},success:function(){$.notify("Reservation updated successfully.","success");$("#add-new-reserve_id").modal("hide");n.Load();n.ClearAll();HideLoader()},error:function(n,t,i){HideLoader();ShowErrorMessage(n,t,i)}})};n.TimeInReservation=function(t){ShowLoader();$.ajax({type:"POST",url:webserviceURL+"reservation/TimeIn",data:{Id:t,BusinessDetailId:n.BusinessId()},success:function(){$.notify("Reservation Time In.","success");n.Load();LoadSummary();HideLoader()},error:function(n,t,i){HideLoader();ShowErrorMessage(n,t,i)}})};n.TimeOutReservation=function(t){ShowLoader();$.ajax({type:"POST",url:webserviceURL+"reservation/TimeOut",data:{Id:t,BusinessDetailId:n.BusinessId()},success:function(){$.notify("Reservation Time Out.","success");n.Load();HideLoader()},error:function(n,t,i){HideLoader();ShowErrorMessage(n,t,i)}})};n.CancelReservation=function(t){ShowLoader();$.ajax({type:"POST",url:webserviceURL+"reservation/cancel",data:{Id:t,BusinessDetailId:n.BusinessId()},success:function(){$.notify("Reservation cancelled successfully.","success");LoadSummary();n.Load();HideLoader()},error:function(n,t,i){HideLoader();ShowErrorMessage(n,t,i)}})};n.MessageGuest=function(t){$.ajax({type:"POST",url:webserviceURL+"reservation/message",data:{Id:t,MessageSent:n.Message()},success:function(){$.notify("Reservation cancelled successfully.","success");n.Load()},error:function(n,t,i){ShowErrorMessage(n,t,i)}})};n.SetSizeValue=function(t,i){n.Size($(i.currentTarget).text());$(i.currentTarget).parent().siblings().removeClass("active");$(i.currentTarget).parent().addClass("active")};n.OnChangeDate=function(){var t=event.target.value;n.ReservationDate(t);n.Load()};n.OnReservationDateChange=function(){var t=event.target.value;n.SelectedDate(t);n.LoadTimeSlots()};$(".search_input").on("keydown",function(t){t.which===13&&n.Load()});n.Add=function(){n.ClearAll();n.LoadTimeSlots();$("#add-new-reserve_id").modal("show")};n.Edit=function(t){ShowLoader();n.ClearAll();$("#add-new-reserve_id").modal("show");n.Mode("UPDATE");n.Id(t.Id());n.GuestTypeId(t.GuestTypeId());$("#GuestTypeId").val(t.GuestTypeId());n.GuestName(t.GuestName());n.Size(t.Size());$("#size"+t.Size()).parent().siblings().removeClass("active");$("#size"+t.Size()).parent().addClass("active");n.Comments(t.Comments());n.MobileNumber(t.GuestMobileNumber());iti.setNumber("+"+t.GuestMobileNumber());n.TimeFrom(t.TimeFrom());n.TimeTo(t.TimeTo());n.ReservationGuestId(t.ReservationGuestId());n.SelectedDate(moment(t.Date()).format("YYYY-MM-DD"));n.LoadTimeSlots(t);HideLoader()};n.ShowMsg=function(t){n.ChatTimer=setInterval(function(){$.ajax({type:"POST",url:webserviceURL+"reservation/GetMessages",data:{ReservationId:t.Id()},success:function(i){n.MyReservationId(t.Id());n.MyGuestName(t.GuestName());n.GuestMessages.removeAll();var r=$.map(i.data.Model,function(n){return new GuestMessage(n)});n.GuestMessages(r)},error:function(n,t,i){ShowErrorMessage(n,t,i)}})},2e3);$.ajax({type:"POST",url:webserviceURL+"reservation/GetMessages",data:{ReservationId:t.Id()},success:function(i){n.MyReservationId(t.Id());n.MyGuestName(t.GuestName());n.GuestMessages.removeAll();var r=$.map(i.data.Model,function(n){return new GuestMessage(n)});n.GuestMessages(r);$(".chat-overlay, .chat-box").fadeIn();$(".chat-close").on("click",function(){clearInterval(n.ChatTimer)})},error:function(n,t,i){ShowErrorMessage(n,t,i)}})};n.Reply=function(){$.ajax({type:"POST",url:webserviceURL+"reservation/Message",data:{Id:n.MyReservationId(),MessageSent:n.Message()},success:function(){$("#txtReply").val("");var t={};t.ReservationId=n.MyReservationId();t.GuestName="Admin";t.MessageFrom="Admin";t.Message=linkify(n.Message());t.MessageDate=getFormatedDate(new Date);t.MessageTime=getFormatedTime(new Date);t.isReplied=ko.observable(!1);n.GuestMessages.unshift(t);HideLoader()},error:function(n,t,i){ShowErrorMessage(n,t,i)}})};n.ClearAll=function(){n.Id("");n.GuestTypeId("");n.GuestName("");n.Size("");n.Comments("");n.MobileNumber("");n.SelectedDate();n.TimeFrom("");n.TimeTo("");n.SearchText("");n.ReservationDate=ko.observable(moment().format("YYYY-MM-DD"));n.Message("");n.MyGuestName("");n.MyReservationId("");n.Mode=ko.observable("NEW");$(".timeslots").removeClass("active");$(".timeslots").find(".input_chk").removeClass("tick");$("#add-new-reserve_id .theme-black-form .form_second li").removeClass("active")};n.Load();n.LoadTimeSlots();n.LoadBusinessInfo();setInterval(function(){n.Load(!0)},6e4)}function Reservation(n){var t=this;t.Id=ko.observable(n.Id);t.ReservationGuestId=ko.observable(n.ReservationGuestId);t.GuestTypeId=ko.observable(n.GuestTypeId);t.Size=ko.observable(n.Size);t.Date=ko.observable(n.Date);t.TimeFrom=ko.observable(n.TimeFrom);t.TimeTo=ko.observable(n.TimeTo);t.ReservedTime=ko.computed(function(){return moment(n.TimeFrom,"HH:mm:ss").format("hh:mm A")+" - "+moment(n.TimeTo,"HH:mm:ss").format("hh:mm A")});t.TimeIn=ko.computed(function(){if(n.TimeIn)return moment(new Date(n.UniversalDateTimeIn),"HH:mm:ss").format("hh:mm A")});t.TimeOut=ko.computed(function(){if(n.TimeOut)return moment(new Date(n.UniversalDateTimeOut),"HH:mm:ss").format("hh:mm A")});t.Comments=ko.observable(n.Comments);t.GuestName=ko.observable(n.GuestName);t.GuestType=ko.observable(n.GuestType);t.GuestMobileNumber=ko.observable(n.GuestMobileNumber);t.IsCancelled=ko.observable(n.IsCancelled);t.GuestTypeCss=ko.computed(function(){return n.GuestTypeId===1?"callin_check":n.GuestTypeId===2?"walkin_check":n.GuestTypeId===3?"mob_check":void 0});t.Reserved=ko.computed(function(){var t;return n.ReservedMinutes?(t=n.ReservedMinutes,t>59?t/60+" hours":t+" min"):"0 min"});t.Status=ko.computed(function(){if(n.IsCancelled!==!0){if(n.TimeIn==null)return"Waiting";if(n.TimeIn&&!n.TimeOut)return"In place";if(n.TimeIn&&n.IsTimeOut)return"Time out"}else return"Cancelled"});t.StatusCss=ko.computed(function(){if(n.IsCancelled!==!0){if(n.TimeIn==null)return"orange_bg";if(n.TimeIn&&!n.TimeOut)return"blue_bg";if(n.TimeIn&&n.IsTimeOut)return"pink_bg"}else return"pink_bg"});t.IsTimeIn=ko.computed(function(){return n.TimeIn==null&&n.TimeOut==null&&n.IsCancelled!=!0?!0:n.TimeIn!=null&&n.TimeOut==null&&n.IsCancelled!=!0?!1:void 0});t.IsTimeOut=ko.computed(function(){return n.TimeIn!=null&&n.TimeOut!=null||n.IsCancelled==!0?!0:!1})}function PagingData(n){var $super=this;this.Page=ko.observable(n.Page);this.PageSize=n.PageSize;this.TotalData=n.TotalData;this.TotalPages=ko.observable(n.TotalPages);this.HasPrev=ko.computed(function(){return $super.Page()>1});this.HasNext=ko.computed(function(){return $super.Page()<$super.TotalPages()});this.GoToPage=function(n){$super.Page(n);reservationViewModel.LoadList()}}function GuestMessage(n){var t=this;t.ReservationId=ko.observable(n.ReservationId);t.isReplied=ko.observable(!1);n.MessageSent&&(t.Message=ko.observable(n.MessageSent),t.isReplied(!1));n.MessageReplied&&(t.Message=ko.observable(n.MessageReplied),t.isReplied(!0));t.GuestName=ko.observable(n.GuestName);t.MessageSentDateTimeUniversal=ko.observable(n.MessageSentDateTimeUniversal);t.MessageFrom=ko.observable(n.MessageSentBy);t.MessageTime=ko.computed(function(){var r=new Date(n.MessageSentDateTimeUniversal),t=r.getHours(),i=r.getMinutes(),u=t>=12?"pm":"am";return t=t%12,t=t?t:12,i=i<10?"0"+i:i,(t<10?"0"+t:t)+":"+i})}function TimeSlot(n){var t=this;t.OpenHourFrom=ko.observable(n.OpenHourFrom);t.OpenHourTo=ko.observable(n.OpenHourTo);t.SpotLeft=ko.observable(n.SpotLeft);t.Time=ko.computed(function(){return moment("1990-01-01 "+n.OpenHourFrom).format("hh:mm A")+" - "+moment("1990-01-01 "+n.OpenHourTo).format("hh:mm A")});t.SetTimeSlot=function(n,t){$(t.currentTarget).siblings().removeClass("active");$(t.currentTarget).addClass("active");$(".input_chk").removeClass("tick");$(t.currentTarget).find(".input_chk").addClass("tick");reservationViewModel.TimeFrom(n.OpenHourFrom());reservationViewModel.TimeTo(n.OpenHourTo())};t.IsHourPassed=ko.computed(function(){var i=new Date,t=moment(reservationViewModel.SelectedDate()),r=moment(t.year()+"-"+(t.month()+1)+"-"+t.date()+" "+n.OpenHourTo);if(i>r)return!0;!1})}$("body").addClass("reservation_body");$(".resv-icon").parent().parent().addClass("active");$(".resv-icon").addClass("show");$('[type="date"].date_picker_show').prop("min",function(){return(new Date).toJSON().split("T")[0]});var input=document.querySelector("#mob_id"),iti=window.intlTelInput(input,{separateDialCode:!0,utilsScript:"/content/intl-tel-input/js/utils.js"}),reservationViewModel=new ReservationViewModel;ko.applyBindings(reservationViewModel);